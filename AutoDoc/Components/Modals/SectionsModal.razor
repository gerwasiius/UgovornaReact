@using AutoDocFront.Components.Shared.Inputs
@using Microsoft.AspNetCore.Components.Forms
@using AutoDocFront.Components.Shared
@using AutoDocFront.Models.Enumerations
@rendermode InteractiveServer

@if (IsOpen)
{
    @if (_isLoading)
    {
        <div class="spinner mt-5"></div>
    }
    else
    {
        <div class="modal-backdrop"></div>
        <div class="modal" tabindex="-1" role="dialog" style="@_modalStyle">
            <div class="modal-dialog modal-custom-size modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header p-2">
                        <div class="d-flex align-items-center">
                            <h5 class="modal-title">
                                @if (ModalMode == ModalMode.VIEW)
                                {
                                    @($"Pregled svih verzija člana: v{Section.Version} | {Section.Name}")
                                }
                                else if (ModalMode == ModalMode.EDIT)
                                {
                                    @($"Izmjena člana: v{Section.Version} | {Section.Name}")
                                }
                                else
                                {
                                    @("Unos novog člana")
                                }
                            </h5>
                        </div>
                        <button type="button" class="btn-close me-2" aria-label="Close" @onclick="CloseAsync"></button>
                    </div>
                    <div class="modal-body pe-5 ps-5 d-flex align-content-center overflow-auto">
                        <div class="row" style="flex: 1; min-height: 60vh;">
                            <div class="col-2 mt-2">
                                @if (ModalMode != ModalMode.VIEW)
                                {
                                    <div class="position-sticky sticky-top" style="top: 10px; z-index: 2;">

                                        <div class="form-group placeholder-scroll-panel" style="height: 100%;">
                                            <label class="form-label mb-1 mt-2">Dostupni parametri:</label>
                                            <PlaceholderGroupList />


                                        </div>
                                    </div>
                                }
                                else if (_listSections != null && _listSections.Count > 0)
                                {
                                    <div class="d-flex align-items-center gap-2 py-2 px-2">
                                        <i class="fa fa-history text-secondary"></i>
                                        <span class="fw-semibold small text-secondary">Prethodne verzije</span>
                                    </div>
                                    <hr class="my-0" />
                                    <nav>
                                        <ul class="list-group navigation-list section-list-container">
                                            @foreach (var sectionItem in _listSections)
                                            {
                                                var isActive = sectionItem.Version == _viewModel.Version;
                                                <li class="list-group-item cursor-pointer border-0 py-2 px-2 mb-1 rounded-3 version-list-item @((sectionItem.Version == _viewModel.Version ? "active" : ""))"
                                                    @onclick="() => SelectVersion(sectionItem)">
                                                    <span>
                                                        @($"v{sectionItem.Version} | {sectionItem.Name}")
                                                        @if (sectionItem.IsActive)
                                                        {
                                                            <span class="badge bg-success ms-2" style="font-size:0.75em;">Aktivna</span>
                                                        }
                                                    </span>
                                                </li>
                                            }
                                        </ul>
                                    </nav>
                                }
                            </div>
                            <div class="col-10">
                                @if (ModalMode == ModalMode.INSERT)
                                {
                                    <EditForm EditContext="_editContext" OnValidSubmit="HandleValidSubmitAsync">
                                        <DataAnnotationsValidator />
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-2">
                                                    <ValidatedInputText Label="Naziv člana"
                                                                        IsRequired="true"
                                                                        @bind-Value="_createModel.Name"
                                                                        FieldExpression="@(() => _createModel.Name)" />
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-2">
                                                    <ReadOnlyInputText Label="Grupa"
                                                                       Value="@Group.Name.ToString()" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-2">
                                                    <ValidatedInputTextArea Label="Opis člana"
                                                                            Rows="2"
                                                                            @bind-Value="_createModel.Description"
                                                                            FieldExpression="@(() => _createModel.Description)" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-12">
                                                <div class="mb-5">
                                                    <label for="Content" class="form-label mb-1 small">Sadržaj</label>
                                                    <ValidationMessage For="@(() => _createModel.Content)" />
                                                    <TinyMCE @bind-Value="_createModel.Content" @ref="_tinyMceEditor" />
                                                </div>
                                            </div>
                                        </div>
                                        @*  <button type="submit" class="btn modal-corporate-button-primary fs-6">
                                            <i class="oi oi-check me-1" style="top: 1.5px"></i>
                                            Spasi
                                        </button> *@
                                    </EditForm>
                                }
                                else if (ModalMode == ModalMode.EDIT)
                                {
                                    <EditForm EditContext="_editContext" OnValidSubmit="HandleValidSubmitAsync">
                                        <DataAnnotationsValidator />
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-2">
                                                    <ValidatedInputText Label="Naziv člana"
                                                                        IsRequired="true"
                                                                        @bind-Value="_updateModel.Name"
                                                                        FieldExpression="@(() => _updateModel.Name)" />
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-2">
                                                    <ReadOnlyInputText Label="Grupa"
                                                                       Value="@Group.Name.ToString()" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-2">
                                                    <ValidatedInputTextArea Label="Opis člana"
                                                                            Rows="2"
                                                                            @bind-Value="_updateModel.Description"
                                                                            FieldExpression="@(() => _updateModel.Description)" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-12">
                                                <div class="mb-2">
                                                    <label for="Content" class="form-label mb-1 small">Sadržaj</label>
                                                    <ValidationMessage For="@(() => _updateModel.Content)" />
                                                    <TinyMCE @bind-Value="_updateModel.Content" @ref="_tinyMceEditor" />
                                                </div>
                                            </div>
                                        </div>
                                    </EditForm>
                                }
                                else if (ModalMode == ModalMode.VIEW)
                                {
                                    <div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <ReadOnlyInputText Label="Naziv člana" Value="@_viewModel.Name" />
                                            </div>
                                            <div class="col-md-6">
                                                <ReadOnlyInputText Label="Grupa" Value="@Group.Name.ToString()" />
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <ReadOnlyInputText Label="Opis člana" Value="@_viewModel.Description" />
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-12">
                                                <label for="Content" class="form-label mb-1 small">Sadržaj</label>
                                                <div class="card-body mb-3 border border-secondary-subtle rounded bg-white base-content-height content-full-height shadow-sm">
                                                    <div class="card-text">
                                                        <p>@(new MarkupString(_viewModel.Content))</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer d-flex justify-content-between align-items-center">
                        <div>
                            @if (ModalMode == ModalMode.EDIT)
                            {
                                if (Section.IsActive == true)
                                {
                                    <button class="btn btn-danger fs-6" @onclick="() => ShowConfirmationDialogAsync(false)">
                                        <i class="fas fa-lock me-1" style="top: 1.5px"></i>
                                        Deaktiviraj član!
                                    </button>
                                }
                                else
                                {
                                    <button class="btn btn-success fs-6" @onclick="() => ShowConfirmationDialogAsync(true)">
                                        <i class="fas fa-unlock" style="top: 1.5px"></i>
                                        Aktiviraj član!
                                    </button>
                                }
                            }
                        </div>
                        <div>
                            @if (ModalMode != ModalMode.VIEW)
                            {
                                <button type="submit" class="btn modal-corporate-button-primary fs-6" @onclick="HandleValidSubmitAsync">
                                    <i class="oi oi-check me-1" style="top: 1.5px"></i>
                                    Spasi
                                </button>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
}
